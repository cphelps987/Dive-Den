YUI.add("notifications-menu-view",function(e){"use strict";e.namespace("Views")[this.name]=e.Base.create("notifications-menu-view",e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this.pollingFailed=!1,this.shouldFetchNotifs=!0,this.notifFilter=["group_topic_new","user_gallery_comment"].join(","),this.get("container").get("innerHTML")===""&&this.setContainerWithTemplate("notifications-menu"),this},loadState:function(){var t=this,n=this.appContext.getViewer();return this.appContext.getModel("person-notifications-models",n.nsid).then(function(r){t.set("personNotificationsModel",r);if(Date.now()-r.getValue("unseenLastFetchedTimestamp")>e.config.flickr.notifications.loading_count_refetch_delay)return r.remoteReadUnseenNotificationCount({id:n.nsid,filter:t.notifFilter},t.appContext).then(null,function(e){t.pollingFailed=!0})})},buildContainer:function(){var e=this,t=e.formatCount99(e.get("personNotificationsModel").getValue("unseenNotificationCount"));return this.setContainerWithTemplate("notifications-menu",{unseenNotificationCount:t}),this},activate:function(){var e=this,t=e.get("personNotificationsModel");e.unseenBadge=e.get("container").one(".c-notification-unseencount"),e.unseenCount=0,e.notifIcon=e.get("container").one(".c-notification-icon"),t.getValue("unseenNotificationCount")===0?e.unseenBadge.addClass("hidden"):e.unseenBadge.removeClass("hidden"),this.registerEventHandler(this.get("container").on("click",e.openMenu.bind(e))),this.registerEventHandler(this.get("container").on("key",e.keyboardToggleMenu.bind(e),"down:13,32")),this.registerEventHandler(this.get("container").on("key",e.enterMenu.bind(e),"down:9,40")),e.pollForUnseenNotifs()},pollForUnseenNotifs:function(){this.pollIntervalId=setInterval(this.readUnseenNotifs.bind(this),e.config.flickr.notifications.polling_delay)},readUnseenNotifs:function(){var t=this,n=this.appContext.getViewer(),r=t.get("personNotificationsModel");r.remoteReadUnseenNotificationCount({id:n.nsid,filter:t.notifFilter},t.appContext).then(function(e){t.shouldFetchNotifs=!0,e!==t.unseenCount&&(t.unseenCount=e,e!==0?(t.unseenBadge.removeClass("hidden"),t.unseenBadge.set("text",t.formatCount99(e))):t.unseenBadge.addClass("hidden"))},function(n){clearInterval(t.pollIntervalId),t.pollingFailed||(t.pollingFailedTimeoutId=setTimeout(t.pollForUnseenNotifs.bind(t),e.config.flickr.notifications.polling_failure_timeout)),t.pollingFailed=!0})},openMenu:function(){this.revealNotifications()},keyboardToggleMenu:function(e){e.preventDefault(),!this.droparound||this.droparound.isClosed?this.revealNotifications():this.droparound.close()},enterMenu:function(e){var t=e.keyCode;if(t===9&&!e.shiftKey&&e.target.getAttribute("aria-expanded")==="true"||t===40){e.preventDefault();var n=this.droparound.get("container").one("div.notifs-droparound");if(n){var r=n.one("a.mail-icon");this.registerEventHandler(r.on("key",this.enterNotificationsList.bind(this),"down:9,40")),r.focus()}}},enterNotificationsList:function(e){var t=e.keyCode;if(t===9&&!e.shiftKey||t===40)e.preventDefault(),this.droparound.get("subview").findFocus.call(this,this.droparound.get("container").one("div.notifs-droparound").one("ul").one("li:first-child"))},revealNotifications:function(){var t=this.appContext.viewportData.getWidth(),n=this.appContext.viewportData.getHeight(),r=t>700?60:67,i=t>700?"":t-2+"px",s=n>1e3?"800px":n-200+"px",o;o=new e.Views["notifications-view"]({appContext:this.appContext,width:i,listHeight:s,shouldFetchNotifs:this.shouldFetchNotifs,notifFilter:this.notifFilter}),o.appContext=this.appContext,this.droparound=new e.Views.FluidDroparound({appContext:this.appContext,dismissOnOverlayClick:!0,dismissOnActionClick:!0,anchorOffsetVertical:-4,anchorOffsetHorizontal:r,mirrorArrowAdjustment:r-11,showDropArrow:!0,contentPadding:0,classList:"notifs-droparound no-border big-shadow",anchorElement:this.get("container").one(".c-notification-icon"),subview:o,observePageResize:!0,positionFixed:!0,autoSizeToContent:!0}),this.droparound.show(),this.unseenBadge.addClass("hidden"),this.shouldFetchNotifs=!1},formatCount99:function(e){return e>=100?"99+":e},destructor:function(){clearInterval(this.pollIntervalId),clearTimeout(this.pollingFailedTimeoutId)}})},"@VERSION@",{requires:["flickr-view","hermes-template-notifications-menu","fluid-droparound-view","notifications-view"],langBundles:["notifications","common"]});
YUI.add("hermes-template-person-card",function(e,t){var n=e.Template.Handlebars.revive({1:function(e,t,n,r,i){var s;return"					"+e.escapeExpression(e.lambda((s=t!=null?t.person:t)!=null?s.realname:s,t))+"\n					"+((s=n["if"].call(t!=null?t:{},t!=null?t.personLocation:t,{name:"if",hash:{},fn:e.program(2,i,0),inverse:e.noop,data:i}))!=null?s:"")+"\n"},2:function(e,t,n,r,i){return" - "},4:function(e,t,n,r,i){var s;return(s=n.each.call(t!=null?t:{},t!=null?t.photostream:t,{name:"each",hash:{},fn:e.program(5,i,0),inverse:e.noop,data:i}))!=null?s:""},5:function(e,t,n,r,i){var s;return(s=n["if"].call(t!=null?t:{},t!=null?t.needsInterstitial:t,{name:"if",hash:{},fn:e.program(6,i,0),inverse:e.program(8,i,0),data:i}))!=null?s:""},6:function(e,t,n,r,i){var s,o,u=t!=null?t:{},a=n.helperMissing,f="function",l=e.escapeExpression,c=e.lambda;return'					<a href="'+l((o=(o=n.url||(t!=null?t.url:t))!=null?o:a,typeof o===f?o.call(u,{name:"url",hash:{},data:i}):o))+'" title="'+l((o=(o=n.title||(t!=null?t.title:t))!=null?o:a,typeof o===f?o.call(u,{name:"title",hash:{},data:i}):o))+'" width="'+l(c((s=(s=t!=null?t.sizes:t)!=null?s.sq:s)!=null?s.width:s,t))+'" height="'+l(c((s=(s=t!=null?t.sizes:t)!=null?s.sq:s)!=null?s.height:s,t))+'" style="background: url(https://s.yimg.com/pw/images/spaceball.gif);" data-track="personCardRecentPhotosClick"></a>\n'},8:function(e,t,n,r,i){var s,o,u=t!=null?t:{},a=n.helperMissing,f="function",l=e.escapeExpression;return'					<a href="'+l((o=(o=n.url||(t!=null?t.url:t))!=null?o:a,typeof o===f?o.call(u,{name:"url",hash:{},data:i}):o))+'" title="'+l((o=(o=n.title||(t!=null?t.title:t))!=null?o:a,typeof o===f?o.call(u,{name:"title",hash:{},data:i}):o))+'" style="background: url('+l(e.lambda((s=(s=t!=null?t.sizes:t)!=null?s.sq:s)!=null?s.displayUrl:s,t))+');" data-track="personCardRecentPhotosClick"></a>\n'},10:function(e,t,n,r,i){return'			<span class="tertiary">'+e.escapeExpression((n.intlMessage||t&&t.intlMessage||n.helperMissing).call(t!=null?t:{},{name:"intlMessage",hash:{intlName:"person.NO_PHOTOS"},data:i}))+"</span>\n"},12:function(e,t,n,r,i){return e.escapeExpression((n.intlMessage||t&&t.intlMessage||n.helperMissing).call(t!=null?t:{},{name:"intlMessage",hash:{intlName:"common.ABOUT"},data:i}))},14:function(e,t,n,r,i){return e.escapeExpression((n.intlMessage||t&&t.intlMessage||n.helperMissing).call(t!=null?t:{},{name:"intlMessage",hash:{intlName:"person.PROFILE"},data:i}))},compiler:[7,">= 4.0.0"],main:function(e,t,n,r,i){var s,o,u=t!=null?t:{},a=n.helperMissing,f=e.escapeExpression,l=e.lambda;return'\n<div>\n	<section>\n		<div class="follow-subview">'+f((n.outlet||t&&t.outlet||a).call(u,t!=null?t["follow-view"]:t,{name:"outlet",hash:{},data:i}))+'</div>\n\n		<div class="attribution">\n			<a href="'+f(l((s=t!=null?t.personURLS:t)!=null?s.photostream:s,t))+'" data-track="personCardAttributionNameClick">\n				<h3 class="fade-out">'+f(l((s=t!=null?t.person:t)!=null?s.username:s,t))+'</h3>\n			</a>\n		</div>\n		<div class="info">\n			<span class="secondary realname fade-out">\n'+((s=n["if"].call(u,(s=t!=null?t.person:t)!=null?s.realname:s,{name:"if",hash:{},fn:e.program(1,i,0),inverse:e.noop,data:i}))!=null?s:"")+"				"+f((o=(o=n.personLocation||(t!=null?t.personLocation:t))!=null?o:a,typeof o=="function"?o.call(u,{name:"personLocation",hash:{},data:i}):o))+'\n			</span>\n		</div>\n\n		<div class="recent-photos">\n'+((s=n["if"].call(u,t!=null?t.photostream:t,{name:"if",hash:{},fn:e.program(4,i,0),inverse:e.program(10,i,0),data:i}))!=null?s:"")+'		</div>\n	</section>\n</div>\n\n<div class="links secondary">\n	<a href="'+f(l((s=t!=null?t.personURLS:t)!=null?s.sendFlickrMail:s,t))+'" data-track="personCardMessageClick">'+f((n.intlMessage||t&&t.intlMessage||a).call(u,{name:"intlMessage",hash:{intlName:"person.MESSAGE"},data:i}))+'</a>\n	<a href="'+f(l((s=t!=null?t.personURLS:t)!=null?s.albums:s,t))+'" data-track="personCardAlbumsClick">'+f((n.intlMessage||t&&t.intlMessage||a).call(u,{name:"intlMessage",hash:{intlName:"person.ALBUMS"},data:i}))+'</a>\n	<a href="'+f(l((s=t!=null?t.personURLS:t)!=null?s.favorites:s,t))+'" data-track="personCardFavesClick">'+f((n.intlMessage||t&&t.intlMessage||a).call(u,{name:"intlMessage",hash:{intlName:"person.FAVES"},data:i}))+'</a>\n	<a class="align-right" href="'+f(l((s=t!=null?t.personURLS:t)!=null?s.profile:s,t))+'" data-track="personCardProfileClick">'+((s=(n.isFlipped||t&&t.isFlipped||a).call(u,"rebootify-profile",{name:"isFlipped",hash:{},fn:e.program(12,i,0),inverse:e.program(14,i,0),data:i}))!=null?s:"")+"</a>\n</div>\n"},useData:!0}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/person-card",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("person-card-view",function(e){e.namespace("Views")[this.name]=e.Base.create("person-card-view",e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this.nsid=e.nsid,this.pathAlias=e.pathAlias,this.set("isActiveViewAgnostic",e.isActiveViewAgnostic||!1),this.get("container").get("innerHTML")===""&&this.setContainerHTML(""),this},subviewConfig:{"follow-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1}},loadState:function(){var t=this,n={contentType:7};return this.nsid?n.id=this.nsid:n.pathAlias=this.pathAlias,(new e.FlickrPromise({person:this.appContext.getModel("person-models",n),photostream:this.appContext.getModel("photostream-models",n),personProfile:this.appContext.getModel("person-profile-models",n)})).then(function(e){return t.personModel=e.person,t.personLocation=e.personProfile.getValue("location"),e.photostream.getValue("photoPageList").getPage({page:1,perPage:5}).then(function(e){t.photostreamPhotos=e})},function(e){t.loadingError=!0,e.code===1&&e.message==="User not found"&&(t.badUser=!0)})},buildContainer:function(){var t,n;return this.loadingError?(this.badUser?n='<span class="no-user">'+this.intlMessage({intlName:"person.NO_LONGER_ON_FLICKR"})+"</span>":n='<span class="error-user">'+this.intlMessage({intlName:"person.ERROR_LOADING"})+"</span>",this.setContainerHTML(n)):(t=this.personModel.toJSON(),this.setContainerWithTemplate("person-card",{person:t,photostream:this.photostreamPhotos.map(function(e){return e.toJSON()}),personLocation:this.personLocation,personURLS:e.URLHelper.generatePersonUrls(this.personModel)})),this},activate:function(){var e=this.get("container"),t=e.one(".follow-view"),n=t.one(".relationship"),r=t.one(".relationship > .is-following"),i=e.one(".attribution");return n?r&&i.addClass("shorter"):i.addClass("full"),this}})},"@VERSION@",{requires:["flickr-view","flickr-promise","hermes-template-person-card","url-helper"],langBundles:["person","common"]});
YUI.add("hermes-lang-person",function(e,t){e.Intl.add("hermes/person","en-US",{MESSAGE:["Message"],ALBUMS:["Albums"],FAVES:["Faves"],PROFILE:["Profile"],NO_PHOTOS:["This user has no photos visible to you."],NO_LONGER_ON_FLICKR:["This user is not found, or no longer on Flickr."],ERROR_LOADING:["Error loading user card. Please try again."],RELATIONSHIP_FRIEND_ERROR:["There was a problem setting your friend relationship."],RELATIONSHIP_FAMILY_ERROR:["There was a problem setting your family relationship."],SIGN_IN_BEFORE_FOLLOW_TITLE:["You found someone to follow!"],SIGN_IN_BEFORE_FOLLOW_MESSAGE:["That's awesome. Just sign in to follow them."],JOIN_FLICKR_AND_FOLLOW:["Join Flickr to never miss a post from ","${person}","."],SIGN_IN_AND_FOLLOW:["Sign in and follow"],CURATOR_PASS_OVER:["Pass over"],CURATOR_PASS_OVER_UNDO:["Undo pass over"]})},"@VERSION@",{requires:["intl"]});
YUI.add("person-menu-view",function(e){var t=require("lib/helpers/type-validator");"use strict",e.namespace("Views")[this.name]=e.Base.create("person-menu-view",e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this.containerSelector=e.containerSelector,this.excludeSelectors=[".no-menu"].concat(e.excludeSelectors||[]),this.personSelector=".avatar.person, .photo-attribution .attribution-icon, .comment-icon.circle-icon a, .show-person-menu",this.dialogCache=[],this.currentDialog,this},loadState:function(){return e.Promise.resolve()},buildContainer:function(){return this.setContainerHTML(""),this},toJSON:function(){var t=e.merge(this.get("user"));return t},activate:function(){this.registerEventHandler(e.one(this.containerSelector).delegate("click",this.onClickTarget.bind(this),this.personSelector,this))},onClickTarget:function(t){var n=this,r;this.shouldProcessTarget(t.target)&&(t.preventDefault(),t.halt(),r=t.target.ancestor().one(this.personSelector)||t.target.ancestor(this.personSelector)||t.target.ancestor("a"),this.createParamsAndManageState(r),e.rapidTracker.beacon(n.name,"personCardOpened"))},shouldProcessTarget:function(e){return e.ancestor()!==null&&!this.excludeSelectors.some(function(t){return e.ancestor().one(t)||e.ancestor(t)})},createParamsAndManageState:function(e){var t=this.getParams(e);this.createDialog(t,e)},getParams:function(e){var n={appContext:this.appContext,isActiveViewAgnostic:!0},r="",i;return r=e.getData("person-nsid")||e.ancestor().getData("person-nsid"),r||(i=e.getAttribute("href")||e.ancestor().getAttribute("href"),i.indexOf("/photos")===0?r=i.replace("/photos/","").replace("/",""):i.indexOf("/groups/")===0&&(r=i.slice(i.lastIndexOf("/")+1))),n.disableRefreshOnRelationshipChange=e.hasClass("no-refresh"),t.nsid(r)?n.nsid=r:n.pathAlias=r,n.signature=r,n},createDialog:function(t,n){var r,i=this;this.fire("open"),e.fire("personMenuOpen"),this.dialogCache.some(function(e){return e.key===t.signature?(r=e.dialog,!0):!1}),r?r.set("anchorElement",n.ancestor().hasClass("comment-icon")?n.ancestor():n):(r=new e.Views.FluidDroparound({appContext:this.appContext,dismissOnOverlayClick:!0,showDropArrow:!0,width:350,height:165,anchorOffsetHorizontal:0,observePageResize:!0,anchorElement:n.ancestor().hasClass("comment-icon")?n.ancestor():n,subview:new e.Views["person-card-view"](t)}),r.on("clickOverlay",function(e){i.nextElClicked=[e.clientX,e.clientY]}),r.on("closeDroparound",function(){setTimeout(function(){if(i.nextElClicked){var t=document.elementFromPoint(i.nextElClicked[0],i.nextElClicked[1]),n;t&&(n=e.one(t),n&&i.personSelector.split(",").some(function(e){return n.hasClass(e.replace(".",""))})&&i.shouldProcessTarget(n)&&i.createParamsAndManageState(n)),i.nextElClicked=null}},10)}),this.dialogCache.length>10&&this.dialogCache.shift(),this.dialogCache.push({key:t.signature,dialog:r})),this.currentDialog=r,r.show()},closeDialog:function(){this.currentDialog&&(this.currentDialog.close(),e.fire("personMenuClose"))},destructor:function(){var t=this;this.currentDialog=null,e.Object.each(this.dialogCache,function(e){t.dialogCache[e]&&(t.dialogCache[e].destroy(),t.dialogCache[e]=null)}),this.dialogCache=[]}})},"@VERSION@",{requires:["flickr-promise","flickr-view","fluid-droparound-view","person-card-view"],langBundles:["person","common"]});
YUI.add("hermes-template-group-card",function(e,t){var n=e.Template.Handlebars.revive({1:function(e,t,n,r,i){var s;return(s=n.each.call(t!=null?t:{},t!=null?t.groupPool:t,{name:"each",hash:{},fn:e.program(2,i,0),inverse:e.noop,data:i}))!=null?s:""},2:function(e,t,n,r,i){var s,o,u=t!=null?t:{},a=n.helperMissing,f="function",l=e.escapeExpression,c=e.lambda;return'				\n				<a href="'+l((o=(o=n.url||(t!=null?t.url:t))!=null?o:a,typeof o===f?o.call(u,{name:"url",hash:{},data:i}):o))+'" title="'+l((o=(o=n.title||(t!=null?t.title:t))!=null?o:a,typeof o===f?o.call(u,{name:"title",hash:{},data:i}):o))+'" width="'+l(c((s=(s=t!=null?t.sizes:t)!=null?s.sq:s)!=null?s.width:s,t))+'" height="'+l(c((s=(s=t!=null?t.sizes:t)!=null?s.sq:s)!=null?s.height:s,t))+'"\n'+((s=n["if"].call(u,t!=null?t.needsInterstitial:t,{name:"if",hash:{},fn:e.program(3,i,0),inverse:e.program(5,i,0),data:i}))!=null?s:"")+"				></a>\n				\n"},3:function(e,t,n,r,i){return'					class="restricted"\n'},5:function(e,t,n,r,i){var s;return'					style="background: url('+e.escapeExpression(e.lambda((s=(s=t!=null?t.sizes:t)!=null?s.sq:s)!=null?s.displayUrl:s,t))+');"\n'},7:function(e,t,n,r,i){var s;return(s=n["if"].call(t!=null?t:{},t!=null?t.canAddPhotos:t,{name:"if",hash:{},fn:e.program(8,i,0),inverse:e.program(10,i,0),data:i}))!=null?s:""},8:function(e,t,n,r,i){var s,o=t!=null?t:{},u=n.helperMissing,a=e.escapeExpression;return'				<p class="tertiary">'+a((n.intlMessage||t&&t.intlMessage||u).call(o,{name:"intlMessage",hash:{intlName:"groups.BE_THE_FIRST"},data:i}))+'</p>\n				<p class="tertiary"><a href="'+a(e.lambda((s=t!=null?t.groupURLS:t)!=null?s.photos:s,t))+'">'+a((n.intlMessage||t&&t.intlMessage||u).call(o,{name:"intlMessage",hash:{intlName:"groups.ADD_SOME_PHOTOS"},data:i}))+"</a></p>\n"},10:function(e,t,n,r,i){return"				<p>"+e.escapeExpression((n.intlMessage||t&&t.intlMessage||n.helperMissing).call(t!=null?t:{},{name:"intlMessage",hash:{intlName:"groups.NO_PHOTOS"},data:i}))+"</p>\n"},12:function(e,t,n,r,i){var s,o=e.escapeExpression;return'	<a href="'+o(e.lambda((s=t!=null?t.groupURLS:t)!=null?s.admin:s,t))+'">'+o((n.intlMessage||t&&t.intlMessage||n.helperMissing).call(t!=null?t:{},{name:"intlMessage",hash:{intlName:"groups.ADMIN_LINK_LABEL"},data:i}))+"</a>\n"},14:function(e,t,n,r,i){var s;return(s=n["if"].call(t!=null?t:{},(s=t!=null?t.group:t)!=null?s.isModerator:s,{name:"if",hash:{},fn:e.program(15,i,0),inverse:e.noop,data:i}))!=null?s:""},15:function(e,t,n,r,i){var s,o=e.escapeExpression;return'		<a href="'+o(e.lambda((s=t!=null?t.groupURLS:t)!=null?s.admin:s,t))+'">'+o((n.intlMessage||t&&t.intlMessage||n.helperMissing).call(t!=null?t:{},{name:"intlMessage",hash:{intlName:"groups.ADMIN_LINK_LABEL"},data:i}))+"</a>\n"},compiler:[7,">= 4.0.0"],main:function(e,t,n,r,i){var s,o=t!=null?t:{},u=n.helperMissing,a=e.escapeExpression,f=e.lambda;return'\n<div>\n	<section>\n		<div class="join-subview">\n\n			'+a((n.outlet||t&&t.outlet||u).call(o,t!=null?t["join-group-view"]:t,{name:"outlet",hash:{},data:i}))+'\n\n		</div>\n\n		<div class="attribution">\n			<a href="'+a(f((s=t!=null?t.groupURLS:t)!=null?s.about:s,t))+'">\n				<h3 class="fade-out">'+a((n.renderTrustedMarkup||t&&t.renderTrustedMarkup||u).call(o,(s=t!=null?t.group:t)!=null?s.title:s,{name:"renderTrustedMarkup",hash:{},data:i}))+'</h3>\n			</a>\n		</div>\n		<div class="stats">\n			<span class="secondary fade-out">'+a((n.intlMessage||t&&t.intlMessage||u).call(o,{name:"intlMessage",hash:{createdYear:t!=null?t.createdYear:t,intlName:"groups.CREATED_YEAR"},data:i}))+" - "+a((n.intlMessage||t&&t.intlMessage||u).call(o,{name:"intlMessage",hash:{updatedAgo:t!=null?t.updatedAgo:t,intlName:"groups.UPDATED_TIME_AGO"},data:i}))+'</span>\n		</div>\n\n		<div class="recent-photos">\n'+((s=n["if"].call(o,t!=null?t.groupPool:t,{name:"if",hash:{},fn:e.program(1,i,0),inverse:e.program(7,i,0),data:i}))!=null?s:"")+'		</div>\n	</section>\n</div>\n\n<div class="links secondary">\n	<a href="'+a(f((s=t!=null?t.groupURLS:t)!=null?s.photos:s,t))+'">'+a((n.intlMessage||t&&t.intlMessage||u).call(o,{name:"intlMessage",hash:{intlName:"groups.PHOTOS_LINK_LABEL"},data:i}))+'</a>\n	<a href="'+a(f((s=t!=null?t.groupURLS:t)!=null?s.discussions:s,t))+'">'+a((n.intlMessage||t&&t.intlMessage||u).call(o,{name:"intlMessage",hash:{intlName:"groups.DISCUSSIONS_LINK_LABEL"},data:i}))+"</a>\n"+((s=n["if"].call(o,(s=t!=null?t.group:t)!=null?s.isAdmin:s,{name:"if",hash:{},fn:e.program(12,i,0),inverse:e.program(14,i,0),data:i}))!=null?s:"")+"</div>"},useData:!0}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/group-card",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("group-card-view",function(e){e.namespace("Views")[this.name]=e.Base.create("group-card-view",e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this.groupId=e.groupId,this.groupPathAlias=e.groupPathAlias,this.set("isActiveViewAgnostic",e.isActiveViewAgnostic||!1),this.get("container").get("innerHTML")===""&&this.setContainerHTML(""),this},subviewConfig:{"join-group-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!1,shortLabels:!0,theme:"light"}},loadState:function(){var t=this,n=this.groupId;return(new e.FlickrPromise({groupPool:this.appContext.getModel("group-pool-models",n),group:this.appContext.getModel("group-models",n),groupInfo:this.appContext.getModel("group-info-models",n)})).then(function(e){return t.groupModel=e.group,t.groupInfo=e.groupInfo,e.groupPool.getValue("photoPageList").getPage({page:1,perPage:5}).then(function(e){t.groupPhotos=e})},function(e){t.loadingError=!0})},buildContainer:function(){var t,n=!1,r;return this.loadingError?this.setContainerHTML('<span class="error-group">'+this.intlMessage({intlName:"groups.ERROR_LOADING"})+"</span>"):(t=this.groupModel.toJSON(),r=this.groupInfo.getValue("throttle"),n=r.mode!=="disabled"&&r.remaining>0||r.mode==="none",n&&(n=t.isMember),this.setContainerWithTemplate("group-card",{group:t,groupPool:this.groupPhotos.map(function(e){return e.toJSON()}),canAddPhotos:n,groupURLS:e.URLHelper.generateGroupUrls(this.groupModel),createdYear:t.dateCreated.year(),updatedAgo:this.intlMessage(e.Handlebars.helpers._friendlySinceDate(t.latestGroupActivity,!0,!0))})),this},activate:function(){return this.registerEventHandler(this.get("container").delegate("click",function(e){e.preventDefault()},".join")),this}})},"@VERSION@",{requires:["flickr-view","flickr-promise","hermes-template-group-card","url-helper","handlebars-helpers"],langBundles:["groups","relative-dates"]});
YUI.add("group-menu-view",function(e){"use strict";e.namespace("Views")[this.name]=e.Base.create("group-menu-view",e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this.containerSelector=e.containerSelector,this.excludeSelectors=[".large",".no-menu"].concat(e.excludeSelectors||[]),this.groupSelector=".avatar.group",this.dialogCache=[],this.currentDialog,this},loadState:function(){return e.Promise.resolve()},buildContainer:function(){return this.setContainerHTML(""),this},activate:function(){this.registerEventHandler(e.one(this.containerSelector).delegate("click",this.onClickTarget.bind(this),this.groupSelector,this))},onClickTarget:function(e){var t;this.shouldProcessTarget(e.target)&&(e.preventDefault(),e.halt(),t=e.target,this.createParamsAndManageState(t))},shouldProcessTarget:function(e){return e.ancestor()!==null&&!this.excludeSelectors.some(function(t){return e.ancestor().one(t)||e.ancestor(t)})},createParamsAndManageState:function(e){var t=this.getParams(e);this.createDialog(t,e)},getParams:function(e){var t={appContext:this.appContext,isActiveViewAgnostic:!0};return t.groupId=e.getData("group-nsid"),t.signature=t.groupId,t},createDialog:function(t,n){var r=this,i;this.fire("open"),this.dialogCache.some(function(e){return e.key===t.signature?(i=e.dialog,!0):!1}),i?i.set("anchorElement",n):(i=new e.Views.FluidDroparound({appContext:this.appContext,dismissOnOverlayClick:!0,showDropArrow:!0,width:350,height:165,observePageResize:!0,anchorElement:n,anchorOffsetHorizontal:4,subview:new e.Views["group-card-view"](t)}),i.on("clickOverlay",function(e){r.nextElClicked=[e.clientX,e.clientY]}),i.on("closeDroparound",function(){setTimeout(function(){if(r.nextElClicked){var t=document.elementFromPoint(r.nextElClicked[0],r.nextElClicked[1]),n,i;t&&(n=e.one(t),i=r.groupSelector.split(",").some(function(e){return n.hasClass(e.replace(".",""))}),n&&i&&r.shouldProcessTarget(n)&&r.createParamsAndManageState(n)),r.nextElClicked=null}},10)}),this.dialogCache.length>10&&this.dialogCache.shift(),this.dialogCache.push({key:t.signature,dialog:i})),this.currentDialog=i,i.show()},closeDialog:function(){this.currentDialog&&this.currentDialog.close()},destructor:function(){var t=this;this.currentDialog=null,e.Object.each(this.dialogCache,function(e){t.dialogCache[e]&&(t.dialogCache[e].destroy(),t.dialogCache[e]=null)}),this.dialogCache=null}})},"@VERSION@",{requires:["flickr-promise","flickr-view","fluid-droparound-view","group-card-view"],langBundles:["common"]});
YUI.add("hermes-template-fluid-modal",function(e,t){var n=e.Template.Handlebars.revive({1:function(e,t,n,r,i){return" html-modal"},3:function(e,t,n,r,i){return" subview-modal"},5:function(e,t,n,r,i){return'<div class="close-x" aria-label="'+e.escapeExpression((n.intlMessage||t&&t.intlMessage||n.helperMissing).call(t!=null?t:{},{name:"intlMessage",hash:{intlName:"common.CLOSE"},data:i}))+'" tabindex="0"></div>'},7:function(e,t,n,r,i){var s;return'		<div class="head">\n'+((s=n["if"].call(t!=null?t:{},t!=null?t.navBarView:t,{name:"if",hash:{},fn:e.program(8,i,0),inverse:e.program(10,i,0),data:i}))!=null?s:"")+'			<div class="extra"></div>\n		</div>\n'},8:function(e,t,n,r,i){return'				<div class="nav"></div>\n'},10:function(e,t,n,r,i){var s;return'				<div class="title">\n'+((s=n["if"].call(t!=null?t:{},t!=null?t.title:t,{name:"if",hash:{},fn:e.program(11,i,0),inverse:e.program(13,i,0),data:i}))!=null?s:"")+"				</div>\n"},11:function(e,t,n,r,i){var s;return"						"+e.escapeExpression((s=(s=n.title||(t!=null?t.title:t))!=null?s:n.helperMissing,typeof s=="function"?s.call(t!=null?t:{},{name:"title",hash:{},data:i}):s))+"\n"},13:function(e,t,n,r,i){return"						"+e.escapeExpression((n.renderTrustedMarkup||t&&t.renderTrustedMarkup||n.helperMissing).call(t!=null?t:{},t!=null?t.htmlTitle:t,{name:"renderTrustedMarkup",hash:{},data:i}))+"\n"},15:function(e,t,n,r,i){return" lines"},17:function(e,t,n,r,i){var s,o,u=t!=null?t:{};return'			<div class="content text-only '+((s=n["if"].call(u,t!=null?t.noScroll:t,{name:"if",hash:{},fn:e.program(18,i,0),inverse:e.noop,data:i}))!=null?s:"")+((s=n["if"].call(u,t!=null?t.showFooter:t,{name:"if",hash:{},fn:e.program(20,i,0),inverse:e.noop,data:i}))!=null?s:"")+'">\n				'+e.escapeExpression((o=(o=n.textMessage||(t!=null?t.textMessage:t))!=null?o:n.helperMissing,typeof o=="function"?o.call(u,{name:"textMessage",hash:{},data:i}):o))+"\n			</div>\n"},18:function(e,t,n,r,i){return" no-scroll"},20:function(e,t,n,r,i){return" has-footer"},22:function(e,t,n,r,i){var s,o=t!=null?t:{};return'			<div class="content html-only '+((s=n["if"].call(o,t!=null?t.noScroll:t,{name:"if",hash:{},fn:e.program(18,i,0),inverse:e.noop,data:i}))!=null?s:"")+((s=n["if"].call(o,t!=null?t.showFooter:t,{name:"if",hash:{},fn:e.program(20,i,0),inverse:e.noop,data:i}))!=null?s:"")+'">\n				'+e.escapeExpression((n.renderTrustedMarkup||t&&t.renderTrustedMarkup||n.helperMissing).call(o,t!=null?t.htmlMessage:t,{name:"renderTrustedMarkup",hash:{},data:i}))+"\n			</div>\n"},24:function(e,t,n,r,i){var s,o=t!=null?t:{};return'			<div class="content subview '+((s=n["if"].call(o,t!=null?t.noScroll:t,{name:"if",hash:{},fn:e.program(18,i,0),inverse:e.noop,data:i}))!=null?s:"")+((s=n["if"].call(o,t!=null?t.showFooter:t,{name:"if",hash:{},fn:e.program(20,i,0),inverse:e.noop,data:i}))!=null?s:"")+'"></div>\n'},26:function(e,t,n,r,i){var s;return'		<div class="foot">\n'+((s=n["if"].call(t!=null?t:{},(s=t!=null?t.buttons:t)!=null?s.visible:s,{name:"if",hash:{},fn:e.program(27,i,0),inverse:e.noop,data:i}))!=null?s:"")+"		</div>\n"},27:function(e,t,n,r,i){var s,o=t!=null?t:{};return'			<div class="buttons">\n				'+((s=n["if"].call(o,(s=(s=t!=null?t.buttons:t)!=null?s.action:s)!=null?s.visible:s,{name:"if",hash:{},fn:e.program(28,i,0),inverse:e.noop,data:i}))!=null?s:"")+"\n				"+((s=n["if"].call(o,(s=(s=t!=null?t.buttons:t)!=null?s.cancel:s)!=null?s.visible:s,{name:"if",hash:{},fn:e.program(33,i,0),inverse:e.noop,data:i}))!=null?s:"")+"\n"+((s=n["if"].call(o,(s=t!=null?t.buttons:t)!=null?s.flavorText:s,{name:"if",hash:{},fn:e.program(35,i,0),inverse:e.noop,data:i}))!=null?s:"")+"			</div>\n"},28:function(e,t,n,r,i){var s,o=t!=null?t:{};return'<button class="mini '+((s=n["if"].call(o,(s=(s=t!=null?t.buttons:t)!=null?s.action:s)!=null?s.isDangerous:s,{name:"if",hash:{},fn:e.program(29,i,0),inverse:e.noop,data:i}))!=null?s:"")+' action"'+((s=n["if"].call(o,(s=(s=t!=null?t.buttons:t)!=null?s.action:s)!=null?s.disabled:s,{name:"if",hash:{},fn:e.program(31,i,0),inverse:e.noop,data:i}))!=null?s:"")+">"+e.escapeExpression(e.lambda((s=(s=t!=null?t.buttons:t)!=null?s.action:s)!=null?s.label:s,t))+"</button>"},29:function(e,t,n,r,i){return"danger"},31:function(e,t,n,r,i){return' disabled="disabled"'},33:function(e,t,n,r,i){var s;return'<button class="mini alt cancel">'+e.escapeExpression(e.lambda((s=(s=t!=null?t.buttons:t)!=null?s.cancel:s)!=null?s.label:s,t))+"</button>"},35:function(e,t,n,r,i){var s,o=t!=null?t:{};return'				<div class="flavor-text secondary'+((s=n.unless.call(o,(s=(s=t!=null?t.buttons:t)!=null?s.flavorText:s)!=null?s.visible:s,{name:"unless",hash:{},fn:e.program(36,i,0),inverse:e.noop,data:i}))!=null?s:"")+'">'+e.escapeExpression((n.renderTrustedMarkup||t&&t.renderTrustedMarkup||n.helperMissing).call(o,(s=(s=t!=null?t.buttons:t)!=null?s.flavorText:s)!=null?s.text:s,{name:"renderTrustedMarkup",hash:{},data:i}))+"</div>\n"},36:function(e,t,n,r,i){return" hidden"},compiler:[7,">= 4.0.0"],main:function(e,t,n,r,i){var s,o,u=t!=null?t:{};return'<div class="modal'+((s=n["if"].call(u,t!=null?t.htmlMessage:t,{name:"if",hash:{},fn:e.program(1,i,0),inverse:e.noop,data:i}))!=null?s:"")+((s=n["if"].call(u,t!=null?t.subview:t,{name:"if",hash:{},fn:e.program(3,i,0),inverse:e.noop,data:i}))!=null?s:"")+" "+e.escapeExpression((o=(o=n.classList||(t!=null?t.classList:t))!=null?o:n.helperMissing,typeof o=="function"?o.call(u,{name:"classList",hash:{},data:i}):o))+'">\n	'+((s=n["if"].call(u,t!=null?t.showCancelX:t,{name:"if",hash:{},fn:e.program(5,i,0),inverse:e.noop,data:i}))!=null?s:"")+"\n"+((s=n["if"].call(u,t!=null?t.showHeader:t,{name:"if",hash:{},fn:e.program(7,i,0),inverse:e.noop,data:i}))!=null?s:"")+'	<div class="body'+((s=n["if"].call(u,t!=null?t.showBodyLines:t,{name:"if",hash:{},fn:e.program(15,i,0),inverse:e.noop,data:i}))!=null?s:"")+'">\n'+((s=n["if"].call(u,t!=null?t.textMessage:t,{name:"if",hash:{},fn:e.program(17,i,0),inverse:e.noop,data:i}))!=null?s:"")+((s=n["if"].call(u,t!=null?t.htmlMessage:t,{name:"if"
,hash:{},fn:e.program(22,i,0),inverse:e.noop,data:i}))!=null?s:"")+((s=n["if"].call(u,t!=null?t.subview:t,{name:"if",hash:{},fn:e.program(24,i,0),inverse:e.noop,data:i}))!=null?s:"")+"	</div>\n"+((s=n["if"].call(u,t!=null?t.showFooter:t,{name:"if",hash:{},fn:e.program(26,i,0),inverse:e.noop,data:i}))!=null?s:"")+"</div>\n"},useData:!0}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/fluid-modal",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("fluid-modal-view",function(e,t){"use strict";var n=require("lib/flog")(t),r,i;r={css:{destinationContainer:"body",closeX:".close-x",buttonCancel:"button.cancel",buttonAction:"button.action",navBarContent:".head .nav",subviewContent:".content.subview",modalContent:".body .content"},options:{}},i={supportsTransform:!1,modal:{height:0,width:0}},e.namespace("Views").FluidModal=e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(t){this.set("isActiveViewAgnostic",!0);var n=this.get("modalOverlayType");return this.alreadyShowingModal=n.alreadyShowingModal(),this.alreadyShowingModal||(n.add(this),e.OverlayManager.ModalOverlay.setOverlayStyle({overlayClassList:this.get("overlayClassList")})),this},activate:function(){var t=this.get("container"),n=this;return this.get("showCancelX")&&this.registerEventHandler(t.one(r.css.closeX).on(["click","keydown"],function(e){(e.type==="click"||e.keyCode===13)&&this.handleCancel(e)},this)),this.get("showFooter")&&this.get("showCancelButton")&&this.get("showButtons")&&this.registerEventHandler(t.one(r.css.buttonCancel).on("click",e.bind(this.handleCancel,this))),this.get("showFooter")&&this.get("showActionButton")&&this.get("showButtons")&&this.registerEventHandler(t.one(r.css.buttonAction).on("click",e.bind(this.handleAction,this))),this.registerEventHandler(this.appContext.flapp.on("activeViewChange",function(e){n.close(e)})),this.registerEventHandler(e.globalEvents.subscribe("window:resize",function(e){n.reposition()})),this.get("navBarView")&&n.get("navBarView").activate(),this.get("subview")&&(n.get("subview").activate(),n.registerEventHandler(n.get("subview").on("actionClick",e.bind(n.handleAction,n)))),this.registerEventHandler(t.delegate("keydown",this.keyboardSelectRadio.bind(this),"label")),this.registerEventHandler(t.ancestor("body").once("key",this.focusOnFirstTab.bind(this),"down:9")),e.Accessibility.manageFocusOutlines(this),this.fire("activated"),this},focusOnFirstTab:function(e){this.get("container").one("[tabindex]").focus()},keyboardSelectRadio:function(e){if(e.keyCode===13){var t=this.get("container").one("#"+e.target.getAttribute("for"));t.set("checked",!t.get("checked"))}},clearOutline:function(){var t=e.one(document.activeElement);t&&t.addClass("no-outline")},restoreOutline:function(){var e=this.get("container").one(":focus");e&&e.removeClass("no-outline")},show:function(){return this.initialize().then(null,function(e){n.error("Error initializing modal",{err:e})}),this.isClosed=!1,this.freeze(),e.fire("flickr:setKeyEventScope",this.getKeyEventScope()),this},freeze:function(){e.one("body").setStyles({overflow:"hidden"})},unfreeze:function(){e.one("body").setStyles({overflow:"visible"})},enableActionButton:function(){var e=this.get("container").one("button.action");e&&e.getAttribute("disabled")&&e.removeAttribute("disabled")},disableActionButton:function(){var e=this.get("container").one("button.action");e&&e.setAttribute("disabled",!0)},showFlavorText:function(){var e=this.get("container").one(".buttons .flavor-text");e&&e.removeClass("hidden")},hideFlavorText:function(){var e=this.get("container").one(".buttons .flavor-text");e&&e.addClass("hidden")},buildContainer:function(){if(!this.alreadyShowingModal){var t=this,s=e.one(r.css.destinationContainer),o;o={showCancelX:this.get("showCancelX"),title:this.get("title"),htmlTitle:this.get("htmlTitle"),navBarView:!!this.get("navBarView"),noScroll:this.get("noScroll"),textMessage:this.get("textMessage"),htmlMessage:this.get("message")?this.get("message"):this.get("htmlMessage"),subview:!!this.get("subview"),showBodyLines:this.get("showBodyLines"),hideModalOverlay:this.get("hideModalOverlay"),darkOverlay:this.get("darkOverlay"),lightOverlay:this.get("lightOverlay"),showHeader:this.get("showHeader"),showFooter:this.get("showFooter"),buttons:{visible:this.get("showButtons"),action:{visible:this.get("showActionButton"),label:this.get("actionButtonLabel"),disabled:this.get("actionButtonDisabled"),isDangerous:this.get("actionButtonIsDangerous")},cancel:{visible:this.get("showCancelButton"),label:this.get("cancelButtonLabel")}},classList:this.get("classList")},this.get("buttonFlavorText")&&(o.buttons.flavorText={visible:this.get("showButtonFlavorText"),text:this.get("buttonFlavorText")}),this.setContainerWithTemplate("fluid-modal",o),i.modal.width=this.get("width"),i.modal.minWidth=this.get("minWidth"),i.modal.height=this.get("height"),this.get("navBarView")&&(this.get("navBarView").appContext=t.appContext,this.get("navBarView").initialize().then(function(e){e.on("subviewViewEvent",function(e){e&&e.details&&e.details.length&&(t.get("subview")&&e.details[0]==="navigation"?t.get("subview").fire.apply(t.get("subview"),["parentViewEvent"].concat(e.details)):t.get("subview")&&e.details[0]==="search"&&t.get("subview").fire.apply(t.get("subview"),["parentViewEvent"].concat(e.details)),t.fire.apply(t,e.details))}),t.get("container").one(r.css.navBarContent).appendChild(e.get("container")),t.get("subview")||t.activate()})),this.get("subview")?(this.get("subview").appContext=t.appContext,this.get("subview").set("isActiveViewAgnostic",!0),this.get("subview").initialize().then(function(e){t.on("parentViewEvent",function(t){t&&t.details&&t.details.length&&e.fire.apply(e,["parentViewEvent"].concat(t.details))}),e.on("subviewViewEvent",function(e){e&&e.details&&e.details.length&&(t.get("navBarView")&&e.details[0]==="backToList"&&t.get("navBarView").fire.apply(t.get("navBarView"),["parentViewEvent"].concat(e.details)),t.fire.apply(t,e.details))}),t.get("container").one(r.css.subviewContent).appendChild(e.get("container")),s&&(s.append(t.get("container")),t.reposition()),t.activate()},function(e){n.error("Error initializing modal subview",{err:e})})):s&&(s.append(this.get("container")),this.reposition())}return this},reposition:function(){var t=this.get("container"),n=t.one(this.get("modalSelector")),s=e.one(e.config.win),o=parseInt(s.get("innerWidth"),10),u=
parseInt(s.get("innerHeight"),10),a=i.modal.width?parseInt(i.modal.width,10):parseInt(n.getComputedStyle("width"),10),f,l=20,c={},h,p,d=n.one(".body"),v=0,m=this.get("showFooter")?parseInt(n.one(".foot").getComputedStyle("height"),10):0,g=0,y=parseInt(d.getComputedStyle("borderTopWidth"),10)+parseInt(d.getComputedStyle("borderBottomWidth"),10),b={};i.modal.height&&(v=parseInt(n.one(".head").getComputedStyle("height"),10),g=i.modal.height,n.get("showFooter")&&(m=parseInt(n.one(".foot").getComputedStyle("height"),10)),i.modal.height+v+m+4*l+y>=u&&(u<=700?g=u-v-m-y:g=u-v-m-4*l-y),n.setStyles({maxHeight:"none"}),this.get("fullWindow")?b.height=g+"px":this.get("maxHeight")&&(b.maxHeight=g+"px"),n.one(r.css.modalContent).setStyles(b)),f=parseInt(n.getComputedStyle("height"),10),h=n.getDOMNode().scrollHeight,p=n.getDOMNode().scrollWidth,c={top:"50%",left:"50%",width:i.modal.width?a+"px":"",marginTop:-(f/2)+"px",marginLeft:-(a/2)+"px",minWidth:i.modal.minWidth?i.modal.minWidth+"px":""},f+2*l>u||h>f+1||a+2*l>o||p>a?(u<=700&&i.modal.height?c.maxHeight=u-10+"px":(c.maxHeight=u-2*l+"px",c.overflow="auto"),c.maxWidth=o-2*l+"px",c.marginTop=-(Math.min(parseInt(c.maxHeight,10),f)/2)+"px",c.marginLeft=-(Math.min(parseInt(c.maxWidth,10),a)/2)+"px"):(c.maxHeight="inherit",c.maxWidth="inherit",c.overflow="visible"),n.setStyles(c)},handleCancel:function(n){var r=this.get("subview");e.rapidTracker.beacon(t,"modalCancelClick"),r&&r.handleCancel&&r.handleCancel(),this.fire("cancelClick",n),this.close(n)},handleAction:function(e){var t=this.get("subview");this.fire("actionClick",e),t&&t.handleAction&&t.handleAction(),this.get("dismissOnActionClick")&&this.close(e)},close:function(t){e.fire("flickr:removeKeyEventScope",this.getKeyEventScope());var n=this.get("container");this.isClosed=!0,e.one("body").removeClass("scroll-fluid-modal"),this.get("subview")&&this.get("subview").destroy(),this.get("navBarView")&&this.get("navBarView").destroy(),n&&n.remove(!0),this.fire("close",t),this.destroy(),this.get("removeOverlayOnClose")||this.get("modalOverlayType").remove(this)},getKeyEventScope:function(){return this.name+this._yuid},destructor:function(){this.unfreeze(),this.detachAll()}},{ATTRS:{showCancelX:{value:!0},showCancelButton:{value:!0},showBodyLines:{value:!1},showActionButton:{value:!0},hideModalOverlay:{value:!1},darkOverlay:{value:!1},lightOverlay:{value:!1},actionButtonLabel:{valueFn:function(){return this.intlMessage({intlName:"common.OK"})}},actionButtonIsDangerous:{value:!1},cancelButtonLabel:{valueFn:function(){return this.intlMessage({intlName:"common.CANCEL"})}},actionButtonDisabled:{value:!1},showButtons:{value:!0},dismissOnOverlayClick:{value:!1},dismissOnActionClick:{value:!0},title:{value:""},htmlTitle:{value:""},navBarView:{value:null},message:{value:null},textMessage:{value:null},htmlMessage:{value:null},width:{value:0},minWidth:{value:0},height:{value:0},fullWindow:{value:!1},subview:{value:null},classList:{value:""},buttonFlavorText:{value:""},showButtonFlavorText:{value:!0},showHeader:{value:!0},showFooter:{value:!0},noScroll:{value:!1},maxHeight:{value:!0},modalSelector:{value:".modal"},modalOverlayType:{value:e.OverlayManager.ModalOverlay},removeOverlayOnClose:{value:!1},overlayClassList:{value:"",validator:function(t,n){return e.AttributeHelpers.validateString(t)},setter:function(t,n){return e.AttributeHelpers.coerceString(t)}}}})},"@VERSION@",{requires:["flickr-view","hermes-template-fluid-modal","fluid-overlay-manager-view","attribute-helpers"],optionalRequires:["fluid"],langBundles:["common"]});
YUI.add("hermes-template-signup-modal",function(e,t){var n=e.Template.Handlebars.revive({1:function(e,t,n,r,i){var s;return" "+e.escapeExpression((s=(s=n.signUpHeaderClass||(t!=null?t.signUpHeaderClass:t))!=null?s:n.helperMissing,typeof s=="function"?s.call(t!=null?t:{},{name:"signUpHeaderClass",hash:{},data:i}):s))},3:function(e,t,n,r,i){var s;return" style=\"background-image:url('"+e.escapeExpression((s=(s=n.signUpHeaderImage||(t!=null?t.signUpHeaderImage:t))!=null?s:n.helperMissing,typeof s=="function"?s.call(t!=null?t:{},{name:"signUpHeaderImage",hash:{},data:i}):s))+"')\""},compiler:[7,">= 4.0.0"],main:function(e,t,n,r,i){var s,o,u=t!=null?t:{},a=n.helperMissing,f="function",l=e.escapeExpression;return'<div class="signup-modal-body">\n	<div class="head'+((s=n["if"].call(u,t!=null?t.signUpHeaderClass:t,{name:"if",hash:{},fn:e.program(1,i,0),inverse:e.noop,data:i}))!=null?s:"")+'"'+((s=n["if"].call(u,t!=null?t.signUpHeaderImage:t,{name:"if",hash:{},fn:e.program(3,i,0),inverse:e.noop,data:i}))!=null?s:"")+'></div>\n	<h3 class="signup-title">'+l((o=(o=n.signUpTitle||(t!=null?t.signUpTitle:t))!=null?o:a,typeof o===f?o.call(u,{name:"signUpTitle",hash:{},data:i}):o))+'</h3>\n	<p class="signup-message">'+l((o=(o=n.signUpMessage||(t!=null?t.signUpMessage:t))!=null?o:a,typeof o===f?o.call(u,{name:"signUpMessage",hash:{},data:i}):o))+'</p>\n	<button class="large action signup-button">'+l((n.intlMessage||t&&t.intlMessage||a).call(u,{name:"intlMessage",hash:{intlName:"common.SIGN_UP_WITH_YAHOO"},data:i}))+'</button>\n</div>\n<div class="signup-modal-footer">\n	<span>'+l((n.intlMessage||t&&t.intlMessage||a).call(u,{name:"intlMessage",hash:{intlName:"common.HAVE_YAHOO_ACCOUNT"},data:i}))+'</span>\n	<a href="#" class="signin-link">'+l((n.intlMessage||t&&t.intlMessage||a).call(u,{name:"intlMessage",hash:{intlName:"common.SIGN_IN"},data:i}))+"</a>\n</div>\n"},useData:!0}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/signup-modal",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("signup-modal-view",function(e,t){"use strict";var n,r;n={css:{destinationContainer:"body",closeX:".close-x",buttonAction:"button.action",navBarContent:".head .nav",subviewContent:".content.subview",modalContent:".body .content"},options:{}},r={supportsTransform:!1,modal:{height:0,width:0}},e.namespace("Views").SignUpModal=e.FlickrView.create(this.name,e.Views.FluidModal,[],{initializer:function(e){return this.set("showFooter",!1),this.set("showHeader",!1),this.set("showButtonFlavorText",!1),this.set("showButtons",!1),this.set("showActionButton",!1),this.set("showCancelButton",!1),this.set("signUpHeaderClass",e.signUpHeaderClass),this.set("signUpHeaderImage",e.signUpHeaderImage),this.set("signUpTitle",e.signUpTitle),this.set("signUpMessage",e.signUpMessage),this.set("beaconPrefix",e.beaconPrefix),this.set("classList","signup-modal"),this},buildContainer:function(){if(!this.alreadyShowingModal){e.rapidTracker.beacon(this.name,this.get("beaconPrefix")+"ModalShow");var t={signUpHeaderClass:this.get("signUpHeaderClass"),signUpHeaderImage:this.get("signUpHeaderImage"),signUpTitle:this.get("signUpTitle"),signUpMessage:this.get("signUpMessage")};this.set("htmlMessage",this.templates("signup-modal")(t)),this.constructor.superclass.buildContainer.call(this)}return this},activate:function(){return this.get("container").one(".signup-button").on("click",this.handleAction.bind(this)),this.get("container").one(".signin-link").on("click",this.handleSignIn.bind(this)),this.constructor.superclass.activate.call(this),this},handleSignIn:function(t){e.rapidTracker.beacon(this.name,this.get("beaconPrefix")+"ModalSignInClick"),this.fire("signInClick",t),this.constructor.superclass.handleAction.call(this)},handleAction:function(t){e.rapidTracker.beacon(this.name,this.get("beaconPrefix")+"ModalSignUpClick"),this.fire("signUpClick",t),this.constructor.superclass.handleAction.call(this)},handleCancel:function(t){e.rapidTracker.beacon(this.name,this.get("beaconPrefix")+"CancelClick"),this.constructor.superclass.handleCancel.call(this)}})},"@VERSION@",{requires:["flickr-view","fluid-modal-view","hermes-template-signup-modal"],optionalRequires:["fluid"],langBundles:["common"]});
YUI.add("hermes-template-signup-interstitial",function(e,t){var n=e.Template.Handlebars.revive({compiler:[7,">= 4.0.0"],main:function(e,t,n,r,i){var s=t!=null?t:{},o=n.helperMissing,u=e.escapeExpression;return'<div class="signup-interstitial-body interstitial-fade">\n	<div class="close-x"></div>\n	<div class="body">\n		<div class="logo"></div>\n		<h3 class="signup-interstitial-message">'+u((n.intlMessage||t&&t.intlMessage||o).call(s,{name:"intlMessage",hash:{intlName:"growth.MINI_SIGNUP_FOOTER_MESSAGE_EXPLORE"},data:i}))+'</h3>\n		<div><a href="/signup" class="butt large action signup-button">'+u((n.intlMessage||t&&t.intlMessage||o).call(s,{name:"intlMessage",hash:{intlName:"common.SIGN_UP_WITH_YAHOO"},data:i}))+'</a></div>\n		<a href="/signin" class="signin-link">'+u((n.intlMessage||t&&t.intlMessage||o).call(s,{name:"intlMessage",hash:{intlName:"common.SIGN_IN"},data:i}))+"</a>\n	</div>\n</div>\n"},useData:!0}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/signup-interstitial",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("signup-interstitial-view",function(e,t){"use strict";var n;n={css:{destinationContainer:"body",closeX:".close-x",buttonAction:"button.action",navBarContent:".head .nav",subviewContent:".content.subview",modalContent:".body .content",modalSelector:".modal"},options:{}},e.namespace("Views").SignUpInterstitial=e.FlickrView.create(this.name,e.Views.FluidModal,[],{langBundles:this.details.langBundles,buildContainer:function(){var t=e.one(n.css.destinationContainer);if(!this.alreadyShowingModal){var r={signUpMessage:this.get("signUpMessage")};this.setContainerWithTemplate("signup-interstitial",r),t&&(t.append(this.get("container")),this.reposition(),this.get("modalOverlayType").get("overlay").removeClass("interstitial-fade"),this.get("container").one(".signup-interstitial-body").removeClass("interstitial-fade"))}return this},activate:function(){var e=this.get("container");this.registerEventHandler(e.one(".signup-button").on("click",this.instrumentSignupClick.bind(this))),this.registerEventHandler(e.one(".signin-link").on("click",this.instrumentSigninClick.bind(this))),this.constructor.superclass.activate.call(this)},instrumentSignupClick:function(n){e.rapidTracker.beacon(t,"signupIntSignupClick")},instrumentSigninClick:function(n){e.rapidTracker.beacon(t,"signupIntSigninClick")},show:function(){e.rapidTracker.beacon(t,"signupIntShown"),this.constructor.superclass.show.call(this)},close:function(n){e.rapidTracker.beacon(t,"signupIntCancelClick"),this.constructor.superclass.close.call(this,n)}},{ATTRS:{showFooter:{value:!1},showHeader:{value:!1},showButtonFlavorText:{value:!1},showButtons:{value:!1},showActionButton:{value:!1},showCancelButton:{value:!1},modalSelector:{value:".signup-interstitial-body"},modalOverlayType:{value:e.OverlayManager.SignupInterstitialOverlay}}})},"@VERSION@",{requires:["flickr-view","fluid-modal-view","hermes-template-signup-interstitial"],optionalRequires:["fluid"],langBundles:["common","growth"]});
YUI.add("hermes-lang-growth",function(e,t){e.Intl.add("hermes/growth","en-US",{MINI_SIGNUP_FOOTER_MESSAGE:["Never miss a post from ","${username}"],MINI_SIGNUP_FOOTER_MESSAGE_EXPLORE:["Join Flickr to explore world class photos"],MINI_SIGNUP_FOOTER_MESSAGE_SEARCH:["Join Flickr to see more ","${query}"," photos!"]})},"@VERSION@",{requires:["intl"]});
YUI.add("signin-helper",function(e){function t(t,n){e.FlickrStorage.store(t,n)}function n(e,n){var r="fave";t(r,e),m(r,n)}function r(e,t){var n="comment";m(n,t)}function i(e,n){var r="share";t(r,e),m(r,n)}function s(e,n){var r="joingroup";t(r,e),m(r,n)}function o(e,n){var r="follow";t(r,e),m(r,n)}function u(e,n){var r="download";t(r,e),m(r,n)}function a(e,n){var r="fave";t(r,e),y(r,n)}function f(e,t){var n="comment";y(n,t)}function l(e,n){var r="joingroup";t(r,e),y(r,n)}function c(e,n){var r="follow";t(r,e),y(r,n)}function h(e,n){var r="download";t(r,e),y(r,n)}function p(t){var n,r,i=[];if(!t)return;if(e.FlickrStorage.hasEntries()){n=e.FlickrStorage.retrieve();for(r in n)d(t,n[r])||i.push(n[r])}return e.FlickrStorage.remove(),i}function d(e,t){var n=t.key,r=t.value;switch(n){case"fave":return v(e,r),!0;case"share":return!1}}function v(e,t){var n=t.id,r=e.getModelRegistry("photo-engagement-models");r.then(function(e){var t=e.proxy(n);t.registry.addAsFave(n)&&t.remoteUpdate()})}function m(t,n){var r,i;n&&n.withPopup?(r=e.config.win.open(g(n),"_blank","height=650,resizable=1,scrollbars=1,location=yes"),i=setInterval(function(){r.closed&&(clearInterval(i),window.location.reload())},1e3)):e.config.win.location=g(n)}function g(t){t=t||{},t.closeWhenDone&&(t.postLoginUrl=e.url("/photo_grease_postlogin.gne",{protocol:!1}));var n=t.postLoginUrl||e.config.win.location.href,r=t.url||e.url("/signin/yahoo/",{protocol:!1});return r+"?redir="+encodeURIComponent(n)}function y(t,n){n=n||{};var r=n.postLoginUrl||e.config.win.location.href,i=n.url||e.url("/signup/",{protocol:!1});e.config.win.location=i+"?redir="+encodeURIComponent(r)}e.FlickrStorage={_storageKey:"flickrStorage",store:function(t,n){try{var r=[];e.StorageHelper.hasEntries(this._storageKey)&&(r=this.retrieve()),r.push({key:t,value:n}),e.StorageHelper.setItem(this._storageKey,JSON.stringify(r))}catch(i){}},retrieve:function(){var t={};try{t=JSON.parse(e.StorageHelper.getItem(this._storageKey))}catch(n){}return t},remove:function(){try{e.StorageHelper.remove(this._storageKey)}catch(t){}},hasEntries:function(){return e.StorageHelper.hasEntries(this._storageKey)}},e.SigninHelper={savePreLoginAction:t,addPendingFave:n,addPendingComment:r,addPendingShare:i,addPendingFollow:o,addPendingJoinGroup:s,addPendingDownload:u,checkPendingQueue:p,_redirectToSignin:m,_redirectToSignUp:y,_getSigninUrl:g,signUpPendingFave:a,signUpPendingComment:f,signUpPendingFollow:c,signUpPendingJoinGroup:l,signUpPendingDownload:h}},"@VERSION@",{requires:["url","storage-helper"]});
YUI.add("hermes-template-mobile-app-upsell",function(e,t){var n=e.Template.Handlebars.revive({1:function(e,t,n,r,i){return"is-android"},3:function(e,t,n,r,i){return"http://play.google.com/store/apps/details?id=com.yahoo.mobile.client.android.flickr"},5:function(e,t,n,r,i){return"http://appstore.com/flickr"},7:function(e,t,n,r,i){return"					"+e.escapeExpression((n.intlMessage||t&&t.intlMessage||n.helperMissing).call(t!=null?t:{},{name:"intlMessage",hash:{intlName:"mobile.APP_ANDROID"},data:i}))+"\n"},9:function(e,t,n,r,i){return"					"+e.escapeExpression((n.intlMessage||t&&t.intlMessage||n.helperMissing).call(t!=null?t:{},{name:"intlMessage",hash:{intlName:"mobile.APP_IOS"},data:i}))+"\n"},11:function(e,t,n,r,i){return"					"+e.escapeExpression((n.intlMessage||t&&t.intlMessage||n.helperMissing).call(t!=null?t:{},{name:"intlMessage",hash:{intlName:"mobile.APP_ANDROID_FREE"},data:i}))+"\n"},13:function(e,t,n,r,i){return"					"+e.escapeExpression((n.intlMessage||t&&t.intlMessage||n.helperMissing).call(t!=null?t:{},{name:"intlMessage",hash:{intlName:"mobile.APP_IOS_FREE"},data:i}))+"\n"},15:function(e,t,n,r,i){return"					"+e.escapeExpression((n.intlMessage||t&&t.intlMessage||n.helperMissing).call(t!=null?t:{},{name:"intlMessage",hash:{intlName:"mobile.INSTALL"},data:i}))+"\n"},17:function(e,t,n,r,i){return"					"+e.escapeExpression((n.intlMessage||t&&t.intlMessage||n.helperMissing).call(t!=null?t:{},{name:"intlMessage",hash:{intlName:"mobile.GET"},data:i}))+"\n"},compiler:[7,">= 4.0.0"],main:function(e,t,n,r,i){var s,o=t!=null?t:{};return'<div id="smartbanner" class="ios">\n	<!-- <button class="sb-close close-banner"></button> -->\n	<div class="sb-container">\n		<span class="sb-icon">\n			<svg class="close-banner icon icon-close"><use xlink:href="#icon-close"></use></svg>\n		</span>\n		<span class="sb-flickr-icon">\n			<div class="outer-logo '+((s=n["if"].call(o,t!=null?t.isAndroid:t,{name:"if",hash:{},fn:e.program(1,i,0),inverse:e.noop,data:i}))!=null?s:"")+'">\n				<div class="ball blue-ball"></div>\n				<div class="ball pink-ball"></div>\n			</div>\n		</span>\n		<div class="sb-info">\n			<a class="sb-button" href="'+((s=n["if"].call(o,t!=null?t.isAndroid:t,{name:"if",hash:{},fn:e.program(3,i,0),inverse:e.noop,data:i}))!=null?s:"")+((s=n["if"].call(o,t!=null?t.isIOS:t,{name:"if",hash:{},fn:e.program(5,i,0),inverse:e.noop,data:i}))!=null?s:"")+'">\n				<strong>\n'+((s=n["if"].call(o,t!=null?t.isAndroid:t,{name:"if",hash:{},fn:e.program(7,i,0),inverse:e.noop,data:i}))!=null?s:"")+((s=n["if"].call(o,t!=null?t.isIOS:t,{name:"if",hash:{},fn:e.program(9,i,0),inverse:e.noop,data:i}))!=null?s:"")+"				</strong>\n				<span>\n"+((s=n["if"].call(o,t!=null?t.isAndroid:t,{name:"if",hash:{},fn:e.program(11,i,0),inverse:e.program(13,i,0),data:i}))!=null?s:"")+'				</span>\n			</a>\n		</div>\n		<div class="sb-view get-app">\n			<span>\n'+((s=n["if"].call(o,t!=null?t.isAndroid:t,{name:"if",hash:{},fn:e.program(15,i,0),inverse:e.noop,data:i}))!=null?s:"")+((s=n["if"].call(o,t!=null?t.isIOS:t,{name:"if",hash:{},fn:e.program(17,i,0),inverse:e.noop,data:i}))!=null?s:"")+"			</span>\n		</div>\n	</div>\n</div>\n"},useData:!0}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/mobile-app-upsell",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("mobile-app-upsell-view",function(e){var t="show-upsell-banner";e.namespace("Views")[this.name]=e.Base.create("mobile-app-upsell-view",e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this.nsid=e.nsid,this.photoId=e.photoId,this.buildContainer(),this},buildContainer:function(){var e=this.appContext.getUA().os;return this.setContainerWithTemplate("mobile-app-upsell",{isAndroid:e==="android",isIOS:e==="ios"}),this},setRootViewAdditionalViewClasses:function(){var e=[],n=this.appContext.getUA().os;return e.push(n),e.push(t),this.set("rootViewAdditionalViewClasses",e),this},activate:function(){var t=this.get("container"),n=t.one(".close-banner"),r=t.one(".get-app"),i=this;return n&&this.registerEventHandler(i.addBannerEvent(n,"dism",i.dismissBanner.bind(i))),r&&this.registerEventHandler(i.addBannerEvent(r,"inst",i.installApp.bind(i))),e.rapidTracker.beacon(this.name,"app_promo_interstitial_shown",{section:"app-interstitial"}),this},addBannerEvent:function(e,t,n){var r=this;return e.on("click",function(e){e.preventDefault(),r.appContext.setCookie({cookieName:t,path:"/",cookieValue:!0,remove:!0}),r.fire("subviewViewEvent","removeUpsell"),n()})},dismissBanner:function(){if(!navigator.cookieEnabled){e.rapidTracker.beacon(this.name,"cookies_off",{section:"app-interstitial"});return}var t=parseInt(this.appContext.getCookie("flaidisn"),10);!t||isNaN(t)?t=0:t+=1,e.rapidTracker.beacon(this.name,"app_promo_interstitial_dismissed"+(t>0?"_"+(t+1):""),{section:"app-interstitial"});var n;t<2?n=e.moment().add(3,"days").toDate():t===2?n=e.moment().add(7,"days").toDate():t===3&&(n=e.moment().add(20,"year").toDate()),this.appContext.setCookie({cookieName:"flaidisn",cookieValue:1,expires:n,remove:!0,path:"/"})},installApp:function(){var t=this.appContext.getUA().os,n=this.appContext.getUA().isWebview,r="photos/"+this.nsid+"/"+this.photoId,i=this;e.rapidTracker.beacon(this.name,"app_promo_interstitial_download",{section:"app-interstitial"}),this.appContext.setCookie({cookieName:"flaidis",cookieValue:1,expires:e.moment().add(20,"year").toDate(),remove:!0,path:"/"}),setTimeout(function(){e.use("mobile-actions-helper",function(e){e.MobileActionsHelper.redirectToAppOrStore({os:t,isWebview:n,pageURL:r,beacon:{name:"app_promo_banner_open",section:"appbanner"},viewName:i.name})})},250)}},{ATTRS:{}}),e.namespace("Views")[this.name].shouldShowBanner=function(e){var t=e.getCookie("dism")||e.getCookie("inst"),n=e.getUA().os,r=n==="android";return!t&&r}},"@VERSION@",{requires:["flickr-view","flickr-promise","hermes-template-mobile-app-upsell"],langBundles:["common","mobile"]});
YUI.add("hermes-lang-mobile",function(e,t){e.Intl.add("hermes/mobile","en-US",{APP_IOS:["Flickr for iOS"],APP_ANDROID:["Flickr for Android"],APP_IOS_FREE:["Free in the App Store"],APP_ANDROID_FREE:["Free in the Google Play"],GET:["Get"],INSTALL:["Install"]})},"@VERSION@",{requires:["intl"]});
YUI.add("hermes-template-partner-account-banner",function(e,t){var n=e.Template.Handlebars.revive({compiler:[7,">= 4.0.0"],main:function(e,t,n,r,i){return'<div class="banner-container">\n	<p>Dear Flickr Member: due to partnership changes with AT&T, you need to update your primary email address. <a class="learn-more">Learn more</a></p>\n</div>\n'},useData:!0}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/partner-account-banner",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-partner-account-modal",function(e,t){var n=e.Template.Handlebars.revive({compiler:[7,">= 4.0.0"],main:function(e,t,n,r,i){return'<div>\n	With the launch of the new att.net homepage on June 30, 2017, you will need to change the primary email address you use to sign into your Flickr/Yahoo account. Your data and photos on Flickr will not be deleted or modified in any way. You will need to complete this process before June 30, 2017 in order to continue accessing your Flickr account.\n	<br/><br/>\n	<a href="/partner-account">Click here to learn more about these changes.</a>\n	<br/><br/>\n	<a href="/beammeup">\n		<button class="update-email">Update your email address</button>\n	</a>\n</div>\n'},useData:!0}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/partner-account-modal",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("partner-account-banner-view",function(e){e.FlickrView.create(this.name,e.FlickrView,[],{buildContainer:function(){return this.setContainerWithTemplate("partner-account-banner"),this},activate:function(){var e=this.get("container").one(".learn-more");return e&&this.registerEventHandler(e.on("click",this.openModal.bind(this))),this},openModal:function(){var t=new e.Views.FluidModal({title:"The way you sign in to Flickr is changing",htmlMessage:this.templates("partner-account-modal")({}),appContext:this.appContext,dismissOnOverlayClick:!0,dismissOnActionClick:!0,showCancelX:!0,showCancelButton:!1,showActionButton:!1,hideModalOverlay:!1,showFooter:!1});t.show()}})},"@VERSION@",{requires:["flickr-view","hermes-template-partner-account-banner","hermes-template-partner-account-modal"]});
YUI.add("global-nav-view",function(e){e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(t){var n,r;typeof t.enableBrowserUpgradeBanner=="undefined"&&(t.enableBrowserUpgradeBanner=!0),this.set("showBrowserUpgradeBanner",!1);if(YUI.Env.isServer&&t.enableBrowserUpgradeBanner){var i=this.appContext.request.headers["user-agent"],s=e.BrowserSupport.isUnsupportedBrowser(i),o=e.BrowserSupport.isBot(i),u=e.BrowserSupport.isSharingBot(i);s&&!o&&!u&&this.set("showBrowserUpgradeBanner",!0)}if(!YUI.Env.isServer){var a=e.StorageHelper.getItem("hasDismissedBrowserUpgradeBanner",!0);a&&a==="true"&&this.set("showBrowserUpgradeBanner",!1)}return this.get("container").get("innerHTML")===""&&this.setContainerHTML('<div class="global-nav-content"></div>'),this.appStateParams=t,this.themeClass=t.theme||"default-theme",n=this.appContext.getLocation(),t.modelParams&&t.modelParams.apiParams?r=t.modelParams.apiParams:r=n.href,this.searchUrl=new e.SearchUrl(r,this.appContext,t.searchType),this.appContext.flipper.isFlipped("enable-signed-out-cta-test")&&(this.signedOutTest=!0),this.appContext.flipper.isFlipped("enable-sign-up-interstitial-test")&&this.appContext.lang.toLowerCase()==="en-us"&&(this.signUpInterstitialTest=!0),this.appContext.flipper.isFlipped("enable-sign-up-rail-test")&&this.appContext.lang.toLowerCase()==="en-us"&&!this.appContext.getViewer().signedIn&&!t.isSOHP&&(this.signUpRailTest=!0),this.isSOHP=t.isSOHP,this},subviewConfig:{"search-autosuggest-field-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0,isSOHP:this.isSOHP},"account-menu-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0},"notifications-menu-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1,disabled:function(){return!this.appContext.flipper.isFlipped("notifications-menu")}},"browser-upgrade-banner-view":{requiredToShowOnServer:!0,requiredToShowOnClient:!1,dealbreaker:!1,disabled:function(){return!this.get("showBrowserUpgradeBanner")}},"person-menu-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1,containerSelector:"#content",excludeSelectors:[".c-account-menu"],disabled:function(){return!this.appContext.flipper.isFlipped("enable-hover-account-menu")||!this.appContext.flipper.isFlipped("rebootify-group-discussions-list")}},"group-menu-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1,containerSelector:"#content",excludeSelectors:[".c-account-menu"],disabled:function(){return!this.appContext.flipper.isFlipped("enable-hover-account-menu")||!this.appContext.flipper.isFlipped("rebootify-group-discussions-list")}},"mobile-app-upsell-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0,disabled:function(t){return!t.isMobile||!e.Views["mobile-app-upsell-view"].shouldShowBanner(this.appContext)}},"signup-rail-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1,additionalViewClasses:["collapsed"],disabled:function(e){return e.isMobile||!this.signUpRailTest}},"flickr-chat-center-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1,disabled:function(e){return!this.appContext.flipper.isFlipped("flickr-chat")||!this.appContext.getViewer().signedIn}},"partner-account-banner-view":{requiredToShowOnServer:!1,requiredToShowOnClient:!1}},loadState:function(){var t=this,n=this.appContext.getViewer(),r;return n.signedIn?r=this.appContext.getModel("person-models",n.nsid).then(function(e){t.set("viewer",e),t.elementStates=t.setElementStates(t.appStateParams),t.set("showPartnerAccountBanner",t.isExpiringPartnerAccount())}):(this.elementStates=this.setElementStates(this.appStateParams),r=e.Promise.resolve()),r},buildContainer:function(){var t={},n=this.appContext.getViewer().signedIn,r;return this.get("viewer")&&(t=e.merge(this.get("viewer").toJSON(),{urls:e.URLHelper.generatePersonUrls(this.get("viewer"))})),r={theme:this.themeClass,"show-browser-upgrade-banner":this.get("showBrowserUpgradeBanner"),showPartnerAccountBanner:this.get("showPartnerAccountBanner"),showNotificationsMenu:!1,viewer:t,isSignedIn:n,elements:this.elementStates},this.appContext.flipper.isFlipped("notifications-menu")&&n&&(r["notifications-menu-view"]=this.subviews["notifications-menu-view"].get("container"),r.showNotificationsMenu=!0),this.setContainerWithTemplate("global-nav",r),this},activate:function(){var t=this,n=this.appContext.getViewer().prefs.keyboardShortcutsEnabled,r,i,s=this.get("container"),o=37,u=46;return i=["photo-page-ad-scrappy-view","sohp-view","products-landing-view"],r=this.appContext.flapp.get("activeView").name,s.one(".mobile-nav-toggle")&&this.registerEventHandler(s.one(".mobile-nav-toggle").on("click",function(n){e.rapidTracker.beacon(t.name,"mobile-nav-toggle",{action:s.one(".global-nav").hasClass("menu-open")?"close":"open"}),s.one(".global-nav").toggleClass("menu-open")}.bind(this))),s.one(".mobile-search-button")?(this.registerEventHandler(s.one(".mobile-search-button").on("click",function(n){e.rapidTracker.beacon(t.name,"mobile-nav-search");var r=this.get("container"),i=r.one(".global-nav");i.addClass("search-open"),i.hasClass("menu-open")&&i.removeClass("menu-open"),t.fire("parentViewEvent","focus-search-field"),r.one(".flickr-logo-container").addClass("hidden")}.bind(this))),this.registerEventHandler(e.on("add-context-to-search-field",function(e){this.get("container").one(".global-nav").addClass("search-open"),t.fire("parentViewEvent","focus-search-field")},this))):this.registerEventHandler(e.globalEvents.subscribe("window:resize",function(n){var r=e.config.win.innerWidth<=700,i=r?this.appContext.viewportData.getWidth():0,o=r?u:0;r||(s.one(".global-nav").removeClass("search-open"),s.one(".flickr-logo-container").removeClass("hidden")),t.fire("parentViewEvent","resize-search-field",i-o)}.bind(this))),s.one(".mobile-search-close-button")&&this.registerEventHandler(s.one(".mobile-search-close-button").on("click",function(e){s.one(".global-nav").removeClass("search-open"),s.one(".flickr-logo-container").removeClass("hidden"),t.fire("parentViewEvent"
,"clear-search-field")}.bind(this))),this.appContext.getViewer().signedIn||(this.signedOutTest&&s.one(".gn-upload .gn-title")&&this.registerEventHandler(s.one(".gn-upload .gn-title").on("click",this.signUpAndUpload.bind(this))),i.indexOf(r)<0&&!this.isMobile&&this.signUpInterstitialTest&&this.startInterstitialTimer()),this.registerEventHandler(s.delegate("keydown",this.toggleSubmenu.bind(this),"a[aria-haspopup=true]")),this.registerEventHandler(s.delegate("keydown",this.enterSubmenu.bind(this),"a[aria-haspopup=true]")),this.registerEventHandler(s.delegate("keydown",this.goToSubmenuHeading.bind(this),"ul.gn-submenu")),this.registerEventHandler(s.delegate("keydown",this.keyboardNavigation.bind(this),"ul.nav-menu")),this.registerEventHandler(s.ancestor("body").on("mouseup",this.clearKeyboardFocus.bind(this))),this.registerEventHandler(s.delegate("mouseup",this.toggleAriaExpanded.bind(this),"a[aria-haspopup=true]")),this},clearKeyboardFocus:function(e){this.get("container").all(".has-keyboard-focus").removeClass("has-keyboard-focus"),this.get("container").all(".nav-menu a[aria-expanded=true]").setAttribute("aria-expanded","false")},toggleAriaExpanded:function(e){e.target.setAttribute("aria-expanded",e.target.getAttribute("aria-expanded")==="false"?"true":"false")},enterSubmenu:function(e){if(e.keyCode===40){e.preventDefault();var t=e.target.next("ul");t&&t.hasClass("has-keyboard-focus")&&(t.one(":first-child").one(":first-child").addClass("has-keyboard-focus"),t.one(":first-child").one(":first-child").focus())}},toggleSubmenu:function(e){var t=e.keyCode;if(t===13||t===32){e.preventDefault();var n=e.target.next("ul");n&&(n.hasClass("has-keyboard-focus")?this.clearKeyboardFocus():(n.addClass("has-keyboard-focus"),e.target.setAttribute("aria-expanded","true")))}},goToSubmenuHeading:function(e,t){if(t||e.keyCode===27){t||this.clearKeyboardFocus();var n=e.target.ancestor("ul.gn-submenu").previous("a");n&&n.focus()}},keyboardNavigation:function(e){var t=e.keyCode,n=t===38||t===9&&e.shiftKey,r=t===40||t===9&&!e.shiftKey;e.target.ancestor("li").ancestor("ul").hasClass("nav-menu")?(n=n&&e.target.ancestor("li").previous("li"),r=r&&!!e.target.ancestor("li").next("li"),n?(this.clearKeyboardFocus(),this.focusOnPreviousItem(e)):r&&(!e.target.next("ul")||!e.target.next("ul").hasClass("has-keyboard-focus"))&&(this.clearKeyboardFocus(),this.focusOnNextItem(e))):n?this.focusOnPreviousItem(e):r&&this.focusOnNextItem(e)},focusOnPreviousItem:function(e){e.preventDefault();var t=e.target.ancestor("li").previous("li");t?t.one(":first-child").focus():e.target.ancestor("ul.gn-submenu")&&this.goToSubmenuHeading(e,!0)},focusOnNextItem:function(e){e.preventDefault();var t=e.target.ancestor("li").next("li");t&&t.one(":first-child").focus()},startInterstitialTimer:function(){var t=this,n,r=!1,i;n=e.StorageHelper.getItem("signUpInterstitialSeen"),n?(n=e.moment(n,"x"),i=e.moment().subtract(2,"days"),i>n&&(r=!0)):r=!0,r&&(this.signUpInterstitialTimer=setTimeout(function(){if(!e.OverlayManager.hasOverlay()&&e.config.win.innerWidth>700){var n=new e.Views.SignUpInterstitial({appContext:t.appContext});n.show(),e.StorageHelper.setItem("signUpInterstitialSeen",e.moment().format("x"))}},4e3))},destructor:function(){clearTimeout(this.signUpInterstitialTimer)},signUpAndUpload:function(t){var n=e.url("/upload/"),r=this.intlMessage({intlName:"global-nav.UPLOAD_MODAL_SIGNUP_TITLE"}),i=this.intlMessage({intlName:"global-nav.UPLOAD_MODAL_SIGNUP_MESSAGE"}),s;t.halt(),e.rapidTracker.beacon(this.name,"uploadButtonClick"),s=new e.Views.SignUpModal({appContext:this.appContext,signUpHeaderClass:"signup-upload",signUpTitle:r,signUpMessage:i,beaconPrefix:"upload"}),s.on("signUpClick",function(t){e.SigninHelper._redirectToSignUp("upload",{postLoginUrl:n})}),s.on("signInClick",function(t){e.SigninHelper._redirectToSignin("upload",{postLoginUrl:n})}),s.show()},executeSearch:function(e){var t=this.get("container").one("#gn-search-field").getDOMNode(),n;n=this.searchUrl.createNewSearch(t.value).getURL(),e.halt(),this.appContext.flapp.navigate(n)},setElementStates:function(e){var t=this.appContext.getViewer(),n=e.isSOHP&&!t.signedIn,r={you_link:!1,you_menu:!1,contacts_menu:!1,groups_menu:!1,explore_menu:!1,weekly_flickr:!1,create_link:!1,create_menu:!1,upload_icon:!1,account_menu:!1,search_bar:!1,signup_link:!1,signin_link:!1,right_side_signup:!1,vr_link:!1};return n?(r.search_bar=!0,r.signin_link=!0,r.signup_link=!0):t.signedIn?(r.you_menu=!0,r.explore_menu=!0,r.upload_icon=!0,r.search_bar=!0,r.account_menu=!0):(r.signup_link=!0,r.explore_menu=!0,r.upload_icon=!0,r.search_bar=!0,r.signin_link=!0),this.appContext.flipper.isFlipped("enable-vr-landing")&&(r.vr_link=!0),t.signedIn&&!n?r.create_menu=!0:!t.signedIn&&!n&&(r.create_link=!0),this.get("viewer")&&(this.appContext.flipper.isFlipped("rebootify-stats")||this.get("viewer").getValue("isPro"))&&(r.stats=!0),this.appContext.lang.toLowerCase()==="en-us"&&(r.weekly_flickr=!0),r.set_not_album=!this.appContext.flipper.isFlipped("rename-set-to-album"),this.signedOutTest&&(r.right_side_signup=!0),r},isExpiringPartnerAccount:function(){var e=this.get("viewer").getValue("expiringPartner"),t=["books-cover-route","embedr-route","books-route","books-back-route","books-page-route","wallart-preview-route","wallart-edit-route","wallart-create-route","creations-route","site-key-route","browser-upgrade-interstitial-route","products-marketplace-eol-route","products-account-payouts-route","error-route"];return this.appContext.flipper.isFlipped("enable-partner-account-banner")&&e&&t.indexOf(this.appContext.routeConfig.module)===-1},onSubviewEvent:function(e,t){t&&e==="mobile-app-upsell-view"&&t[0]==="removeUpsell"&&this.subviews["mobile-app-upsell-view"].destroy({remove:!0})}})},"@VERSION@",{requires:["flickr-view","hermes-template-global-nav","search-url","search-autosuggest-field-view","querystring-parse-simple","querystring-stringify-simple","notifications-menu-view","url-helper","person-menu-view","group-menu-view","browser-support"
,"fluid-modal-view","signup-modal-view","signup-interstitial-view","signin-helper","storage-helper","mobile-app-upsell-view","partner-account-banner-view"],langBundles:["global-nav","common","search"]});
YUI.add("hermes-lang-global-nav",function(e,t){e.Intl.add("hermes/global-nav","en-US",{FLICKR_LOGO_ALT:["Flickr logo. If you click it, you'll go home"],YOUR_PHOTOSTREAM:["Your Photostream"],FOLLOWING:["Following"],PHOTOS_OF:["Photos of"],PHOTOS_FROM:["Photos from"],LIST:["List"],COMMUNITIES:["Communities"],GROUPS_LIST:["Groups List"],SEARCH_GROUPS:["Search Groups"],RECENT_DISCUSSIONS:["Recent Discussions"],CREATE_A_GROUP:["Create a Group"],RECENT_PHOTOS:["Recent Photos"],THE_COMMONS:["The Commons"],GETTY_COLLECTION:["Getty Collection"],GALLERIES:["Galleries"],FLICKR_GALLERIES:["Flickr Galleries"],WORLD_MAP:["World Map"],APP_GARDEN:["App Garden"],THE_WEEKLY_FLICKR:["The Weekly Flickr"],FLICKR_BLOG:["Flickr Blog"],UPLOAD:["Upload"],SIGN_IN:["Sign In"],SEARCH:["Search"],CAMERA_FINDER:["Camera Finder"],RECENT_ACTIVITY:["Recent Activity"],STATS:["Stats"],ORGANIZE:["Organize"],CREATIONS:["Creations"],FIND_FRIENDS:["Find Friends"],GROUPS:["Groups"],PEOPLE:["People"],CAMERAROLL:["Camera Roll"],CREATE:["Create"],CREATE_NEW:["New Creation"],CREATE_MY_WALLART:["My Wall Art"],CREATE_MY_PHOTOS_BOOKS:["My Photo Books"],CREATE_ORDER_HISTORY:["My Order History"],UPLOAD_MODAL_SIGNUP_TITLE:["Upload your photos securely and privately!"],UPLOAD_MODAL_SIGNUP_MESSAGE:["Join Flickr to unlock 1,000GB of free photo storage."],HOME:["Home"],LOG_IN:["Log In"]})},"@VERSION@",{requires:["intl"]});
