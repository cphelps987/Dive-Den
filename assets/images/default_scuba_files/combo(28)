YUI.add("flickr-groups-discuss-replies-getList-fetcher",function(e,t){"use strict";function n(t,n,r){var i=t[0],s=t[1],o=t[2],u,a=[],f,l;return i&&i.replies&&i.replies.topic&&(f=i.replies.topic,l={id:n,authorNSID:f.author,authorPathAlias:f.author_path_alias,authorName:f.authorname,authorBuddyicon:e.URLHelper.getBuddyIconURL(f.author,f.author_iconfarm,f.author_iconserver),canDelete:f.canDelete,role:f.role,canEdit:f.canEdit,canReply:f.canReply,countReplies:f.total,dateCreated:e.moment(f.datecreate,"X"),dateLastPost:e.moment(f.datelastpost,"X"),groupId:f.groupId,groupPathAlias:f.groupPathAlias,isLocked:f.isLocked,authorIsPro:f.isPro,isSticky:f.isSticky,lastReplyId:f.lastReply,subject:f.subject,message:f.message.content,authorIsDeleted:f.authorIsDeleted,rawMessage:f.rawMessage,lastReplierNSID:f.lastReplier?f.lastReplier.nsid:null,lastReplierPathAlias:f.lastReplier?f.lastReplier.path_alias:null,lastReplierName:f.lastReplier?f.lastReplier.name:null,lastReplierIsPro:f.lastReplier?f.lastReplier.isPro:!1,lastReplierBuddyicon:f.lastReplier?e.URLHelper.getBuddyIconURL(f.lastReplier.nsid,f.lastReplier.iconfarm,f.lastReplier.iconserver):null,lastEdit:e.moment.min(e.moment.unix(f.lastedit),e.moment.unix(f.datecreate))},i.replies.reply&&i.replies.reply.length>0?i.replies.reply.forEach(function(t){var n=t.id;u={id:n,authorNSID:t.author,authorName:t.authorname,isPro:t.isPro,role:t.role,authorBuddyicon:e.URLHelper.getBuddyIconURL(t.author,t.iconfarm,t.iconserver),canDelete:t.canDelete,canEdit:t.canEdit,canReply:f.canReply,dateCreated:e.moment(t.datecreate,"X"),message:t.message.content,rawMessage:t.rawMessage,lastEdit:t.lastedit!=="0"?e.moment(t.lastedit,"X"):!1,authorIsDeleted:t.authorIsDeleted},t.lasteditDetails&&(u.lastEditAuthor=t.lasteditDetails.author,u.lastEditAuthorName=t.lasteditDetails.authorname,u.lastEditRole=t.lasteditDetails.role,u.isStaffEdit=t.lasteditDetails.isStaffEdit),o.addOrUpdate(u),a.push(o.proxy(n))}):a=[],l.replies={perPage:r.per_page,page:r.page,pageContent:a,totalItems:parseInt(f.total,10)},s.addOrUpdate(l)),a.slice(0,r.per_page)}function r(n,r){var i=n.id,s={topic_id:i,per_page:n.fetchPageSize||20,group_id:n.groupId,page:n.page||1,extras:"is_locked, icon_urls, secure_image_embeds, show_raw_messages, full_response, editor_details, check_rss, last_replier"},o=this;return e.Promise.all([r.callAPI("flickr.groups.discuss.replies.getList",s,!0),r.getModelRegistry("discussion-topic-models"),r.getModelRegistry("discussion-reply-models")]).then(function(e){return o._processResponse(e,i,s)},e.FetcherErrorLogger(t))}e.namespace("ListFetchers")["flickr-groups-discuss-replies-getList"]={run:r,_processResponse:n}},"@VERSION@",{requires:["flickr-promise","api-helper","url-helper","flutil","moment"]});
YUI.add("flickr-groups-discuss-topics-edit-updater",function(e,t){"use strict";function n(n,r){var i;return i={subject:n.subject,message:n.message,group_id:n.groupId,topic_id:n.topicId,extras:"is_locked, icon_urls, secure_image_embeds, show_raw_messages, full_response, editor_details, last_replier"},n.preview&&(i.extras+=", only_preview"),e.Promise.all([r.callAPI("flickr.groups.discuss.topics.edit",i),r.getModel("discussion-topic-models",n.topicId)]).then(function(t){var r=t[0],i=t[1];return n.preview?{message:r.topic.message.content,rawMessage:r.topic.rawMessage}:(i.setValues({message:r.topic.message.content,rawMessage:r.topic.rawMessage,subject:r.topic.subject,lastEdit:e.moment(e.moment(r.topic.lastedit,"X")._d)}),i)},e.FetcherErrorLogger(t))}e.namespace("ModelUpdaters")["flickr-groups-discuss-topics-edit"]={run:n}},"@VERSION@",{requires:["flickr-promise","moment"],optional:[]});
YUI.add("flickr-groups-discuss-topics-delete-deletor",function(e,t){"use strict";function n(e){var t={topic_id:e.topicId,group_id:e.groupId};return t}function r(e,t){var n=e[1];return n}function i(n,r){var i=this,s=this._processParams(n);return e.Promise.all([r.callAPI("flickr.groups.discuss.topics.delete",s),r.getModelRegistry("discussion-topic-models")]).then(function(e){return i._processResponse(e,n)},e.FetcherErrorLogger(t))}e.namespace("ModelDeletors")["flickr-groups-discuss-topics-delete"]={run:i,_processParams:n,_processResponse:r}},"@VERSION@",{requires:["flickr-promise","group-pool-models"],optional:[]});
YUI.add("discussion-topic-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ListFetchers["flickr-groups-discuss-replies-getList"].run(t,this.appContext)},update:function(t){return e.ModelUpdaters["flickr-groups-discuss-topics-edit"].run(t,this.appContext)},"delete":function(t){return e.ModelDeletors["flickr-groups-discuss-topics-delete"].run(t,this.appContext)}},getReplyPage:function(e){return this.appContext.callAPI("flickr.groups.discuss.replies.getPage",{group_id:e.groupId,topic_id:e.topicId,reply_id:e.replyId,per_page:e.perPage||20}).then(function(e){return e.reply.replyPage})},makeSticky:function(e){return this.appContext.callAPI("flickr.groups.discuss.topics.setSticky",{group_id:e.groupId,topic_id:e.topicId,stickiness:e.makeSticky?1:0})},lockTopic:function(e){var t;return e.lock?t="flickr.groups.discuss.topics.close":t="flickr.groups.discuss.topics.open",this.appContext.callAPI(t,{group_id:e.groupId,topic_id:e.topicId})},attributes:{groupId:{validator:function(t,n){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)}},groupPathAlias:{validator:function(t,n){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)}},authorNSID:{validator:function(t,n){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)}},authorPathAlias:{validator:function(t,n){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)}},authorName:{validator:function(t,n){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)}},authorIsPro:{defaultValue:!1,setter:function(t){return e.AttributeHelpers.coerceBoolean(t)}},authorBuddyicon:{validator:function(t,n){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)}},canDelete:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)}},canEdit:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)}},canReply:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)}},countReplies:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},dateCreated:{validator:function(t){return e.AttributeHelpers.validateDate(t)},setter:function(t){return e.AttributeHelpers.coerceDate(t)},serialize:function(e){return e.format("X")},deserialize:function(t){return e.moment(t,"X")}},lastEdit:{validator:function(t){return e.AttributeHelpers.validateDate(t)},setter:function(t){return e.AttributeHelpers.coerceDate(t)}},lastReplyDate:{validator:function(t){return e.AttributeHelpers.validateDate(t)},setter:function(t){return e.AttributeHelpers.coerceDate(t)}},dateLastPost:{validator:function(t){return e.AttributeHelpers.validateDate(t)},setter:function(t){return e.AttributeHelpers.coerceDate(t)},serialize:function(e){return e.format("X")},deserialize:function(t){return e.moment(t,"X")}},dateSinceLastPost:{readOnly:!0,derivedBy:["dateLastPost"],getter:function(e,t){return this.getValue(t,"dateLastPost")}},isLocked:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)}},isSticky:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)}},lastReplyId:{validator:function(t,n){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)}},lastReplierBuddyicon:{validator:function(t,n){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)},derivedBy:["authorBuddyicon","countReplies"],getter:function(e,t){return this.getValue(t,"countReplies")>0?e:this.getValue(t,"authorBuddyicon")}},lastReplierPathAlias:{validator:function(t,n){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)},derivedBy:["authorPathAlias","countReplies"],getter:function(e,t){return this.getValue(t,"countReplies")>0?e||this.getValue(t,"lastReplierNSID"):this.getValue(t,"authorPathAlias")}},lastReplierNSID:{validator:function(t,n){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)},derivedBy:["authorNSID","countReplies"],getter:function(e,t){return this.getValue(t,"countReplies")>0?e:this.getValue(t,"authorNSID")}},lastReplierName:{validator:function(t,n){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)},derivedBy:["authorName","countReplies","authorIsDeleted"],getter:function(e,t){return this.getValue(t,"countReplies")>0?e:this.getValue(t,"authorName")}},lastReplierMessage:{validator:function(t,n){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)}},lastReplierURL:{readOnly:!0,derivedBy:["id","lastReplierPathAlias","lastReplierNSID"],getter:function(e,t){return"/photos/"+(this.getValue(t,"lastReplierPathAlias")||this.getValue(t,"lastReplierNSID"))+"/"}},lastReplierIsDeleted:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},lastReplierIsPro:{defaultValue:!1,setter:function(t){return e.AttributeHelpers.coerceBoolean(t)}},authorIsDeleted:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},role:{validator:function(t,n){return e.AttributeHelpers.validateString(t)},setter
:function(t){return e.AttributeHelpers.coerceString(t)},defaultValue:"member"},subject:{validator:function(t,n){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)}},message:{validator:function(t,n){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)}},rawMessage:{validator:function(t,n){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)}},replies:{isCollection:!0,pageFetch:{listFetcher:e.ListFetchers["flickr-groups-discuss-replies-getList"]}},url:{readOnly:!0,derivedBy:["id","groupDiscussionUrl"],defaultFn:function(e){var t=this.getValue(e,"groupDiscussionUrl");return t?t+e+"/":undefined}},groupDiscussionUrl:{readOnly:!0,derivedBy:["id","groupId","groupPathAlias"],defaultFn:function(e){var t=this.getValue(e,"groupPathAlias")||this.getValue(e,"groupId");return t?"/groups/"+t+"/discuss/":undefined}},lastReplyUrl:{readOnly:!0,derivedBy:["id","lastReplyId","url"],defaultFn:function(e){var t=this.getValue(e,"url"),n=this.getValue(e,"lastReplyId");if(!n||n==="0")n="";return n&&(n+="/"),t?t+n:undefined}},authorUrl:{readOnly:!0,derivedBy:["id","authorPathAlias","authorNSID"],defaultFn:function(e){var t=this.getValue(e,"authorNSID"),n=this.getValue(e,"authorPathAlias");return n?"/photos/"+n+"/":t?"/photos/"+t+"/":undefined}}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","flickr-groups-discuss-replies-getList-fetcher","flickr-groups-discuss-topics-edit-updater","flickr-groups-discuss-topics-delete-deletor","url-helper","attribute-helpers","moment"]});
YUI.add("group-discussions-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){var n=this;return e.ListFetchers["flickr-groups-discuss-topics-getList"].run(t,this.appContext).then(function(e){return n})}},attributes:{discussions:{isCollection:!0,pageFetch:{listFetcher:e.ListFetchers["flickr-groups-discuss-topics-getList"]}},totalItems:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},discussionLocked:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},discussionRSS:{validator:function(t,n){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)}},geoRSS:{validator:function(t,n){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)}},poolRSS:{validator:function(t,n){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)}},showRSS:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","flickr-groups-discuss-topics-getList-fetcher","attribute-helpers"]});
YUI.add("flickr-groups-discuss-topics-getList-fetcher",function(e,t){"use strict";function n(t,n,r){var i=t[0],s=t[1],o=t[2],u=t[3],a=t[4],f,l,c,h,p=[],d;return i&&i.topics&&(f={id:i.topics.groupId,totalItems:i.topics.total,discussionLocked:i.topics.group_is_locked,showRSS:i.groupRss?i.groupRss.showRss:!1,discussionRSS:i.groupRss?i.groupRss.rssDiscussUrl:null,geoRSS:i.groupRss?i.groupRss.geoRssPoolUrl:null,poolRSS:i.groupRss?i.groupRss.rssPoolUrl:null},i.topics.topic&&i.topics.topic.length>0?i.topics.topic.forEach(function(t){var n=t.id;d={authorNSID:t.author,authorPathAlias:t.author_path_alias,authorName:t.authorname,authorBuddyicon:e.URLHelper.getBuddyIconURL(t.author,t.iconfarm,t.iconserver),authorIsPro:t.isPro,canDelete:t.canDelete,canEdit:t.canEdit,canReply:t.canReply,countReplies:t.countReplies,dateCreated:e.moment(t.datecreate,"X"),dateLastPost:e.moment(t.datelastpost,"X"),id:n,role:t.role,groupId:i.topics.groupId,groupPathAlias:i.topics.path_alias,isLocked:t.isLocked,isSticky:t.isSticky,lastReplyId:t.lastReply,subject:t.subject,message:t.message.content,rawMessage:t.rawMessage,authorIsDeleted:t.authorIsDeleted,lastReplierNSID:t.lastReplier?t.lastReplier.nsid:null,lastReplierPathAlias:t.lastReplier?t.lastReplier.path_alias:null,lastReplierName:t.lastReplier?t.lastReplier.name:null,lastReplierBuddyicon:t.lastReplier?e.URLHelper.getBuddyIconURL(t.lastReplier.nsid,t.lastReplier.iconfarm,t.lastReplier.iconserver):null,lastReplierIsDeleted:t.authorIsDeleted&&t.author===(t.lastReplier?t.lastReplier.nsid:null),lastReplierIsPro:t.lastReplier?t.lastReplier.isPro:!1,lastReplierMessage:t.lastReplier?t.lastReplier.lastReply:null,lastReplyDate:t.lastReplier?e.moment(t.lastReplier.datecreate,"X"):null,lastEdit:e.moment.min(e.moment.unix(t.lastedit),e.moment.unix(t.datecreate))},o.addOrUpdate(d),p.push(o.proxy(n))}):p=[],f.discussions={perPage:r.per_page,page:r.page,pageContent:p,totalItems:i.topics.total},s.exists(n)?s.setValue(n,"discussions",f):s.add(f)),i.viewDates?(i.viewDates.pool!=="0"?c=e.moment.unix(i.viewDates.pool):c=a.getDefaultViewedDate(),i.viewDates.discussions!=="0"?h=e.moment.unix(i.viewDates.discussions):h=a.getDefaultViewedDate()):(c=a.getDefaultViewedDate(),h=a.getDefaultViewedDate()),l={id:n,viewedPool:c,viewedDiscussions:h,group:u},a.addOrUpdate(l),p}function r(n,r){var i=n.id,s,o=this;return s={group_id:i,per_page:n.fetchPageSize||20,page:n.page||1,extras:"is_locked, last_replier, view_dates, secure_image_embeds, show_raw_messages, full_response, editor_details, check_rss, is_pro"},e.Promise.all([r.callAPI("flickr.groups.discuss.topics.getList",s,!0),r.getModelRegistry("group-discussions-models"),r.getModelRegistry("discussion-topic-models"),r.getModel("group-models",i),r.getModelRegistry("group-activity-models")]).then(function(e){return o._processResponse(e,i,s)},e.FetcherErrorLogger(t))}e.namespace("ListFetchers")["flickr-groups-discuss-topics-getList"]={run:r,_processResponse:n}},"@VERSION@",{requires:["flickr-promise","api-helper","url-helper","flutil","moment"],optional:["discussion-topic-models","group-discussions-models","group-activity-models"]});
